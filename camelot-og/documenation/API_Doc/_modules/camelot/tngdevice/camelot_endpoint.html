
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>camelot.tngdevice.camelot_endpoint &#8212; Camelot Python SDK v12.6.22.12.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Camelot Python SDK v12.6.22.12.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../camelot.html" accesskey="U">camelot</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for camelot.tngdevice.camelot_endpoint</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;Camelot Endpoint</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">tng.api</span> <span class="k">import</span> <span class="n">creatable_device</span>
<span class="kn">from</span> <span class="nn">tng.api</span> <span class="k">import</span> <span class="n">until</span>
<span class="kn">from</span> <span class="nn">tng.device.endpoint.ciscophone</span> <span class="k">import</span> <span class="p">(</span><span class="n">CiscoPhoneAudioChannel</span><span class="p">,</span>
                                            <span class="n">CiscoPhoneVideoChannel</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">tng.device.interfaces.cp_feedback_handler</span> <span class="k">import</span> <span class="n">CiscoPhoneFeedbackHandler</span>
<span class="kn">from</span> <span class="nn">tng.device.interfaces.cisco_phone_interface</span> <span class="k">import</span> <span class="n">CiscoPhoneInterface</span>
<span class="kn">from</span> <span class="nn">tng</span> <span class="k">import</span> <span class="n">media</span>
<span class="kn">from</span> <span class="nn">tng.device.endpoint.ciscophone</span> <span class="k">import</span> <span class="n">CiscoPhone</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">tng.plugins.plugin</span> <span class="k">import</span> <span class="n">DevicePlugin</span>
<span class="kn">import</span> <span class="nn">camelot</span>
<span class="kn">from</span> <span class="nn">camelot.tngdevice.plugins.camelot_feedback_plugin</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">CamelotFeedbackPlugin</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">camelot.utils.vapi_ei_utils</span> <span class="k">import</span> <span class="n">VAPIEIUtils</span>
<span class="kn">from</span> <span class="nn">tng.frontend</span> <span class="k">import</span> <span class="n">timing</span>
<span class="kn">from</span> <span class="nn">tng.api</span> <span class="k">import</span> <span class="n">interface</span>
<span class="kn">from</span> <span class="nn">camelot.protocol.tcp.camelot_connection</span> <span class="k">import</span> <span class="ne">ConnectionError</span>
<span class="kn">from</span> <span class="nn">camelot.tngdevice.tng_endpoint</span> <span class="k">import</span> <span class="n">CamelotTngEndpoint</span>
<span class="kn">from</span> <span class="nn">pyparsing</span> <span class="k">import</span> <span class="n">ParseException</span>
<span class="kn">from</span> <span class="nn">tng.frontend.setupfile_parser</span> <span class="k">import</span> <span class="n">SetupParserException</span>
<span class="kn">from</span> <span class="nn">tng.frontend</span> <span class="k">import</span> <span class="n">setupfile_parser</span>
<span class="kn">from</span> <span class="nn">tng.device_helpers.addresses</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">DeviceAddrs</span><span class="p">,</span> <span class="n">validate_and_classify_addr_str</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">camelot.utils.rawendpoint_helper</span> <span class="k">import</span> <span class="n">InActionObject</span>
<span class="kn">from</span> <span class="nn">camelot</span> <span class="k">import</span> <span class="n">CamelotError</span>
<span class="kn">from</span> <span class="nn">camelot.tngdevice.plugins.ssh_plugin</span> <span class="k">import</span> <span class="n">CamelotSshPlugin</span>
<span class="kn">from</span> <span class="nn">tng.plugins.scp_plugin</span> <span class="k">import</span> <span class="n">ScpPlugin</span>
<span class="kn">import</span> <span class="nn">tng</span>
<span class="kn">from</span> <span class="nn">camelot.utils</span> <span class="k">import</span> <span class="n">camelot_ep_template_file</span> <span class="k">as</span> <span class="n">template</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;Camelot&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CamelotTTSParser</span><span class="p">(</span><span class="n">setupfile_parser</span><span class="o">.</span><span class="n">TtsFileParser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fp</span><span class="p">):</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">used</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">test_members</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parseFile</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ParseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">):</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Parsing configfile </span><span class="si">%s</span><span class="s1"> failed because </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s1">&#39;line&#39;</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;^</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">msg</span>

            <span class="k">raise</span> <span class="n">SetupParserException</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">objname</span><span class="p">,</span> <span class="n">member</span><span class="p">),</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">objname</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">member</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;targets&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span><span class="p">]:</span>
                    <span class="n">test_members</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                            <span class="n">devices</span><span class="p">[</span><span class="n">val</span><span class="p">][</span><span class="s1">&#39;target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">member</span> <span class="o">==</span> <span class="s1">&#39;targets&#39;</span><span class="p">)</span>
                            <span class="n">used</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">SetupParserException</span><span class="p">(</span>
                                <span class="s2">&quot;Unknown device name &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">values</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">member</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;config_params&#39;</span><span class="p">,</span> <span class="s1">&#39;config_headers&#39;</span><span class="p">]:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Config value </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">=&#39;</span><span class="si">%s</span><span class="s2">&#39; picking last one&quot;</span><span class="p">,</span>
                                    <span class="n">objname</span><span class="p">,</span> <span class="n">member</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># allow for empty passwords</span>
                    <span class="k">if</span> <span class="s1">&#39;password&#39;</span> <span class="ow">in</span> <span class="n">member</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">SetupParserException</span><span class="p">(</span>
                            <span class="s1">&#39;Missing value for </span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">objname</span><span class="p">,</span> <span class="n">member</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">objname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">objname</span><span class="p">,</span>
                        <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                        <span class="s1">&#39;addrs&#39;</span><span class="p">:</span> <span class="n">DeviceAddrs</span><span class="p">([{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;TTS&#39;</span><span class="p">}],</span> <span class="p">[])}</span>
                    <span class="n">devices</span><span class="p">[</span><span class="n">objname</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span>
                    <span class="n">ip_protocol_specified</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="n">devices</span><span class="p">[</span><span class="n">objname</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="n">member</span> <span class="o">==</span> <span class="s1">&#39;ip_protocol&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;ipv4&#39;</span>
                    <span class="n">device</span><span class="p">[</span><span class="s1">&#39;addrs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_mode</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">ip_protocol_specified</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">member</span> <span class="o">==</span> <span class="s1">&#39;ip&#39;</span><span class="p">:</span>
                    <span class="n">addr_type</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">validate_and_classify_addr_str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;addrs&#39;</span><span class="p">],</span> <span class="n">addr_type</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ip_protocol_specified</span><span class="p">:</span>
                        <span class="n">device</span><span class="p">[</span><span class="s1">&#39;addrs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">default_mode</span> <span class="o">=</span> <span class="n">addr_type</span>
                <span class="k">elif</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_names</span><span class="p">:</span>
                    <span class="n">device</span><span class="p">[</span><span class="s1">&#39;device_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">member</span>
                <span class="k">elif</span> <span class="n">member</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;rootusername&#39;</span><span class="p">,</span> <span class="s1">&#39;rootpassword&#39;</span><span class="p">]:</span>
                    <span class="n">device</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="n">member</span> <span class="o">==</span> <span class="s1">&#39;ipv4&#39;</span><span class="p">:</span>
                    <span class="n">device</span><span class="p">[</span><span class="s1">&#39;addrs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ipv4</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">elif</span> <span class="n">member</span> <span class="o">==</span> <span class="s1">&#39;ipv6&#39;</span><span class="p">:</span>
                    <span class="n">device</span><span class="p">[</span><span class="s1">&#39;addrs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ipv6</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">device</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">if</span> <span class="n">test_members</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;targets&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">devices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">devices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">used</span><span class="p">:</span>
                    <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Ignoring device </span><span class="si">%s</span><span class="s1"> which is neither in &#39;</span>
                                <span class="s1">&#39;test.eps or test.targets&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">ret</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">camelot_get_parser</span><span class="p">(</span><span class="n">formatname</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">formatname</span> <span class="o">==</span> <span class="s1">&#39;tts&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">CamelotTTSParser</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">l_get_parser</span><span class="p">(</span><span class="n">formatname</span><span class="p">)</span>

<span class="n">l_get_parser</span> <span class="o">=</span> <span class="n">setupfile_parser</span><span class="o">.</span><span class="n">get_parser</span>
<span class="n">setupfile_parser</span><span class="o">.</span><span class="n">get_parser</span> <span class="o">=</span> <span class="n">camelot_get_parser</span>


<span class="nd">@interface</span><span class="p">(</span><span class="s1">&#39;vapi&#39;</span><span class="p">,</span> <span class="s1">&#39;CamelotEP&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CamelotPhoneInterface</span><span class="p">(</span><span class="n">CiscoPhoneInterface</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">dial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">call_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_device_dial</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">call_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_call_info</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">call_info</span> <span class="ow">and</span> <span class="n">call_info</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="s1">&#39;held&#39;</span><span class="p">,</span> <span class="s1">&#39;localheld&#39;</span><span class="p">,</span> <span class="s1">&#39;remoteheld&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">resume</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;resume failed:[</span><span class="si">%s</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">endcall</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">disconnect_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">release_calls</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_calls</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">calls</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">calls</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">call</span><span class="p">[</span><span class="s1">&#39;Ref&#39;</span><span class="p">])</span>

                <span class="k">def</span> <span class="nf">__call_disconnected</span><span class="p">():</span>
                    <span class="n">c_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_call_info</span><span class="p">(</span><span class="n">call</span><span class="p">[</span><span class="s1">&#39;Ref&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">c_info</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;disconnected&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="n">timing</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                    <span class="n">__call_disconnected</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">raise_on_timeout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Received exception: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">blind_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_id</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_get_call_id</span><span class="p">(</span><span class="n">callstate</span><span class="p">):</span>
            <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_calls</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;CallState&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">callstate</span><span class="p">:</span>
                    <span class="n">call_ref</span> <span class="o">=</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;Ref&#39;</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">call_ref</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">def</span> <span class="nf">_is_alerting</span><span class="p">():</span>
            <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_calls</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;CallState&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alerting&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">_is_offhooked</span><span class="p">():</span>
            <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_calls</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;CallState&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dialtone&#39;</span><span class="p">:</span>

                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">def</span> <span class="nf">_is_transfer_ready</span><span class="p">():</span>
            <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_calls</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;CallState&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;alerting&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">call_id</span><span class="p">):</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">_is_offhooked</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">raise_on_timeout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">transfer_callid</span> <span class="o">=</span> <span class="n">_get_call_id</span><span class="p">(</span><span class="s1">&#39;dialtone&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">transfer_callid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">dial</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">transfer_callid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unable to retrieve the call id of the dialing call&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">_is_transfer_ready</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">raise_on_timeout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">_is_alerting</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">raise_on_timeout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">transfer_callid</span> <span class="o">=</span> <span class="n">_get_call_id</span><span class="p">(</span><span class="s1">&#39;alerting&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">transfer_callid</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">transfer_callid</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unable to retrieve call id of the alerting call&#39;</span><span class="p">)</span>
                <span class="k">return</span>

    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_get_call_id</span><span class="p">(</span><span class="n">callstate</span><span class="p">):</span>
            <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_calls</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;CallState&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">callstate</span><span class="p">:</span>
                    <span class="n">call_ref</span> <span class="o">=</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;Ref&#39;</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">call_ref</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">is_conf_initiator</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">transfer_callid</span> <span class="o">=</span> <span class="n">_get_call_id</span><span class="p">(</span><span class="s1">&#39;connected&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">conference</span><span class="p">(</span><span class="n">transfer_callid</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">CamelotEndpoinPlugin</span><span class="p">(</span><span class="n">DevicePlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;vapi&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ep_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ep_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">client_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cas_protocol</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cas_board</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">cas_trunk</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cas_country</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cas_line</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CamelotEndpoinPlugin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="o">=</span> <span class="n">ep_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep_name</span> <span class="o">=</span> <span class="n">ep_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_data</span> <span class="o">=</span> <span class="n">client_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cas_board</span> <span class="o">=</span> <span class="n">cas_board</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cas_trunk</span> <span class="o">=</span> <span class="n">cas_trunk</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cas_country</span> <span class="o">=</span> <span class="n">cas_country</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cas_protocol</span> <span class="o">=</span> <span class="n">cas_protocol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cas_line</span> <span class="o">=</span> <span class="n">cas_line</span>

    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">frontend</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">cam_srv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cam_srv</span> <span class="o">=</span> <span class="n">camelot</span><span class="o">.</span><span class="n">create_camelot_server</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
            <span class="n">cam_srv</span><span class="o">.</span><span class="n">_tng_cleanup_required</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="n">camelot</span><span class="o">.</span><span class="n">CamelotError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">e_type</span> <span class="o">==</span> <span class="s1">&#39;Internal&#39;</span><span class="p">:</span>
                <span class="n">cam_srv</span> <span class="o">=</span> <span class="n">camelot</span><span class="o">.</span><span class="n">get_camelot_server</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;warning::failed to create camelot&quot;</span>
                      <span class="s2">&quot;serverip:</span><span class="si">{}</span><span class="s2"> port:</span><span class="si">{}</span><span class="s2"> reason:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cam_srv</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_data</span><span class="p">:</span>
                <span class="n">frontend</span> <span class="o">=</span> <span class="n">cam_srv</span><span class="o">.</span><span class="n">attach_endpoint</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client_data</span><span class="p">,</span> <span class="n">ep_class</span><span class="o">=</span><span class="n">CamelotTngEndpoint</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="o">==</span> <span class="s1">&#39;cas&#39;</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;CamelotEndpointPlugin createendpoint cas&#39;</span><span class="p">)</span>
                    <span class="n">frontend</span> <span class="o">=</span> <span class="n">cam_srv</span><span class="o">.</span><span class="n">create_new_endpoint</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_name</span><span class="p">,</span>
                        <span class="n">ep_class</span><span class="o">=</span><span class="n">CamelotTngEndpoint</span><span class="p">,</span>
                        <span class="n">cas_board_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cas_board</span><span class="p">,</span>
                        <span class="n">cas_line_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cas_trunk</span><span class="p">,</span>
                        <span class="n">cas_country</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cas_country</span><span class="p">,</span>
                        <span class="n">cas_protocol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cas_protocol</span><span class="p">,</span>
                        <span class="n">cas_line_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cas_line</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;CamelotEndpointPlugin createendpoint not cas&#39;</span><span class="p">)</span>
                    <span class="n">frontend</span> <span class="o">=</span> <span class="n">cam_srv</span><span class="o">.</span><span class="n">create_new_endpoint</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_name</span><span class="p">,</span>
                        <span class="n">ep_class</span><span class="o">=</span><span class="n">CamelotTngEndpoint</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">frontend</span><span class="p">:</span>
            <span class="n">frontend</span><span class="o">.</span><span class="n">_device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span>
            <span class="n">frontend</span><span class="o">.</span><span class="n">in_service</span> <span class="o">=</span> <span class="n">frontend</span><span class="o">.</span><span class="n">inservice</span>
            <span class="n">frontend</span><span class="o">.</span><span class="n">out_of_service</span> <span class="o">=</span> <span class="n">frontend</span><span class="o">.</span><span class="n">outofservice</span>
            <span class="n">frontend</span><span class="o">.</span><span class="n">init_ep</span> <span class="o">=</span> <span class="n">frontend</span><span class="o">.</span><span class="n">init</span>
            <span class="n">frontend</span><span class="o">.</span><span class="n">uninit_ep</span> <span class="o">=</span> <span class="n">frontend</span><span class="o">.</span><span class="n">uninit</span>
            <span class="n">frontend</span><span class="o">.</span><span class="n">transfer_VM</span> <span class="o">=</span> <span class="n">frontend</span><span class="o">.</span><span class="n">transfer_vm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_namespace</span><span class="p">(</span><span class="n">frontend</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>


<span class="k">class</span> <span class="nc">CamelotPresentationChannel</span><span class="p">(</span><span class="n">CiscoPhoneVideoChannel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CamelotPresentationChannel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">media</span><span class="o">.</span><span class="n">PRESENTATION</span>


<span class="nd">@creatable_device</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">Camelot</span><span class="p">(</span><span class="n">CiscoPhone</span><span class="p">):</span>
    <span class="n">_model_number_regex</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">version_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        (?P&lt;product_code&gt;\w+)\s(?P&lt;major_version&gt;(\d+)).</span>
<span class="sd">        (?P&lt;minor_version&gt;(\d+)).</span>
<span class="sd">        (?P&lt;revision&gt;(\d+)).(?P&lt;build_num&gt;(\d+))</span>
<span class="sd">        (?P&lt;second_build_num&gt;\.(\d+)\.(\d+))</span>
<span class="sd">        &#39;&#39;&#39;</span><span class="p">,</span>
        <span class="n">re</span><span class="o">.</span><span class="n">I</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>
    <span class="c1"># &lt;FIXME:&gt; These were added for compliance with the ABCDevice definition</span>

    <span class="k">def</span> <span class="nf">_boot_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_restart_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
    <span class="c1"># &lt;/FIXME:&gt;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">ep_type</span><span class="o">=</span><span class="s1">&#39;sipx&#39;</span><span class="p">,</span> <span class="n">camelot_ip</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span>
                 <span class="n">camelot_port</span><span class="o">=</span><span class="mi">9004</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">CLIENT_VERSION</span><span class="p">,</span>
                 <span class="n">username</span><span class="o">=</span><span class="s1">&#39;camuser&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;ciscocisco1&#39;</span><span class="p">,</span>
                 <span class="n">config_params</span><span class="o">=</span><span class="p">{},</span> <span class="n">config_headers</span><span class="o">=</span><span class="p">{},</span> <span class="n">log_params</span><span class="o">=</span><span class="p">{},</span>
                 <span class="n">auto_register</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inservice_timeout</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">wait_to_register</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">station_event_callback</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">client_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback_handler_cls</span> <span class="o">=</span> <span class="n">CamlotFeedbackHandler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback_handler_classes</span> <span class="o">=</span> <span class="p">(</span><span class="n">CamlotFeedbackHandler</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="o">=</span> <span class="n">ep_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_data</span> <span class="o">=</span> <span class="n">client_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignore_complex_spontaneous_calls</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CiscoPhone</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">ip</span><span class="p">,</span> <span class="n">engine</span><span class="p">,</span> <span class="n">ep_type</span><span class="o">=</span><span class="n">ep_type</span><span class="p">,</span> <span class="n">camelot_ip</span><span class="o">=</span><span class="n">camelot_ip</span><span class="p">,</span>
            <span class="n">camelot_port</span><span class="o">=</span><span class="n">camelot_port</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
            <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">,</span>
            <span class="n">config_params</span><span class="o">=</span><span class="n">config_params</span><span class="p">,</span> <span class="n">config_headers</span><span class="o">=</span><span class="n">config_headers</span><span class="p">,</span>
            <span class="n">log_params</span><span class="o">=</span><span class="n">log_params</span><span class="p">,</span> <span class="n">auto_register</span><span class="o">=</span><span class="n">auto_register</span><span class="p">,</span>
            <span class="n">inservice_timeout</span><span class="o">=</span><span class="n">inservice_timeout</span><span class="p">,</span>
            <span class="n">wait_to_register</span><span class="o">=</span><span class="n">wait_to_register</span><span class="p">,</span>
            <span class="n">station_event_callback</span><span class="o">=</span><span class="n">station_event_callback</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cli_version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam_ip</span> <span class="o">=</span> <span class="n">camelot_ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">camelot_port</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s1">&#39;addr&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cam_mac</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">addr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cam_mac</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dict_args</span><span class="p">(</span><span class="n">config_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dict_args</span><span class="p">(</span><span class="n">config_headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auto_register</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">auto_register</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">auto_register</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auto_register</span> <span class="o">=</span> <span class="n">auto_register</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inservice_timeout</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">inservice_timeout</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">inservice_timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inservice_timeout</span> <span class="o">=</span> <span class="n">inservice_timeout</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wait_to_register</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">wait_to_register</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">wait_to_register</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_to_register</span> <span class="o">=</span> <span class="n">wait_to_register</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_station_event_callback</span> <span class="o">=</span> <span class="n">station_event_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ep_log_params</span> <span class="o">=</span> <span class="n">log_params</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_params</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;IMP: in case of EP craetion failed: &#39;</span>
                      <span class="s1">&#39;Unable to read Config params, Invalid type&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_log_params</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ep_log_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dict_args</span><span class="p">(</span><span class="n">log_params</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_log_params</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;IMP: in case of EP craetion failed: &#39;</span>
                          <span class="s1">&#39;Unable to read endpoint log params, Invalid type&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_args</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;IMP: in case of EP craetion failed: &#39;</span>
                      <span class="s1">&#39;Failed to validate args&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span> <span class="o">=</span> <span class="s1">&#39;Camelot Endpoint&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s1">&#39;Camelot&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">feedback_receiver</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cam_feedback</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supported_protocols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sip&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pending_feedback_handler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_conf_initiator</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_initialise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">camelot_ip</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;camelot_ip&#39;</span><span class="p">)</span>
        <span class="n">camelot_port</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;camelot_port&#39;</span><span class="p">)</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;version&#39;</span><span class="p">)</span>
        <span class="n">cas_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;_initialise kwargs is </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">camelot_port</span><span class="p">:</span>
            <span class="n">camelot_port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">camelot_port</span><span class="p">)</span>
        <span class="n">end_point_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ep_type&#39;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;_initialise eptype is </span><span class="si">%s</span><span class="s1"> len is </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">end_point_type</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_point_type</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">end_point_type</span> <span class="o">==</span> <span class="s1">&#39;cas&#39;</span><span class="p">:</span>
            <span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;board_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;board_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;line_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;country&#39;</span><span class="p">,</span> <span class="s1">&#39;ind&#39;</span><span class="p">)</span>
            <span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;protocol&#39;</span><span class="p">,</span> <span class="s1">&#39;nocc&#39;</span><span class="p">)</span>
            <span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;line_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;_initialise cas_params is </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">cas_params</span><span class="p">)</span>
            <span class="n">vapi_plugin</span> <span class="o">=</span> <span class="n">CamelotEndpoinPlugin</span><span class="p">(</span>
                <span class="n">host</span><span class="o">=</span><span class="n">camelot_ip</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">camelot_port</span><span class="p">,</span>
                <span class="n">ep_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">ep_type</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ep_type&#39;</span><span class="p">),</span>
                <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
                <span class="n">check_target_match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_target_match</span><span class="p">,</span>
                <span class="n">setup_action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_setup_camelot_device</span><span class="p">,</span>
                <span class="n">client_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client_data</span><span class="p">,</span>
                <span class="n">cas_trunk</span><span class="o">=</span><span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;line_id&#39;</span><span class="p">],</span>
                <span class="n">cas_board</span><span class="o">=</span><span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;board_id&#39;</span><span class="p">],</span>
                <span class="n">cas_protocol</span><span class="o">=</span><span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;protocol&#39;</span><span class="p">],</span>
                <span class="n">cas_country</span><span class="o">=</span><span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;country&#39;</span><span class="p">],</span>
                <span class="n">cas_line</span><span class="o">=</span><span class="n">cas_params</span><span class="p">[</span><span class="s1">&#39;line_num&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vapi_plugin</span> <span class="o">=</span> <span class="n">CamelotEndpoinPlugin</span><span class="p">(</span>
                <span class="n">host</span><span class="o">=</span><span class="n">camelot_ip</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">camelot_port</span><span class="p">,</span>
                <span class="n">ep_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span>
                <span class="n">ep_type</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ep_type&#39;</span><span class="p">),</span>
                <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
                <span class="n">check_target_match</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_target_match</span><span class="p">,</span>
                <span class="n">setup_action</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_setup_camelot_device</span><span class="p">,</span>
                <span class="n">client_data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">client_data</span><span class="p">)</span>
        <span class="n">feedback_plugin</span> <span class="o">=</span> <span class="n">CamelotFeedbackPlugin</span><span class="p">(</span><span class="n">vapi_plugin</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>
        <span class="n">ssh_plugin</span> <span class="o">=</span> <span class="n">CamelotSshPlugin</span><span class="p">(</span><span class="n">camelot_ip</span><span class="p">,</span>
                                      <span class="n">credential</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">[</span><span class="s1">&#39;default&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugins</span> <span class="o">|=</span> <span class="p">{</span>
            <span class="n">vapi_plugin</span><span class="p">,</span>
            <span class="n">feedback_plugin</span><span class="p">,</span>
            <span class="n">ssh_plugin</span><span class="p">,</span>
            <span class="n">ScpPlugin</span><span class="p">(</span><span class="n">ssh_plugin</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">feedback_plugin</span>

    <span class="k">def</span> <span class="nf">_is_nogencert_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parm_val</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;in _is_nogencert_key&#39;</span><span class="p">)</span>
        <span class="n">no_gen_cert</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">call_gen_cert_key</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">parm_val</span> <span class="ow">and</span> <span class="n">parm_val</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
            <span class="n">no_gen_cert</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;calling gen_cert_key reason:parm set&#39;</span><span class="p">)</span>
            <span class="n">call_gen_cert_key</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">no_gen_cert</span><span class="p">,</span> <span class="n">call_gen_cert_key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_configure_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method decides to call gencertkey based on:</span>
<span class="sd">        1. nogencertkey parm, preference always is given to this parm</span>
<span class="sd">        2. isedge parm.</span>
<span class="sd">        Also this method sets audio_only flag based on parm, and sets hardware</span>
<span class="sd">        configs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_params</span><span class="p">:</span>
            <span class="n">no_gen_cert</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">call_gen_cert_key</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_params</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;nogencertkey&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">nogen_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="n">key</span><span class="p">)</span>
                    <span class="p">[</span><span class="n">no_gen_cert</span><span class="p">,</span> <span class="n">call_gen_cert_key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_nogencert_key</span><span class="p">(</span>
                        <span class="n">nogen_val</span><span class="p">)</span>
                <span class="k">elif</span> <span class="s1">&#39;.phone.isedge&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;calling gen_cert_key reason:isedge&#39;</span><span class="p">)</span>
                    <span class="n">call_gen_cert_key</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="s1">&#39;.phone.secured&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span>
                        <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]):</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;calling gen_cert_key reason:secured&#39;</span><span class="p">)</span>
                    <span class="n">call_gen_cert_key</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="s1">&#39;vidpayloadtype&#39;</span> <span class="ow">in</span> <span class="n">key</span> <span class="ow">or</span> <span class="s1">&#39;vidcodectype&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;making audio_only false reason:parm set&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">no_gen_cert</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;jabber&#39;</span><span class="p">,</span> <span class="s1">&#39;jabbermobile&#39;</span><span class="p">]:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;calling gen_cert_key reason:&#39;</span>
                              <span class="s1">&#39;jabber/jabbermobile&#39;</span><span class="p">)</span>
                    <span class="n">call_gen_cert_key</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">call_gen_cert_key</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">gen_cert_key</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_set_hardware_from_config</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_configure_config_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_headers</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_headers</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_header</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;config headers success </span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])))</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;_configure_config_headers:&#39;</span>
                              <span class="s1">&#39; config </span><span class="si">%s</span><span class="s1"> failed.&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_valid_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">int_str</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">int_str</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_set_hardware_from_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="n">type_val</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;sip.phone.modelnumber&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sip.phone.modelnumber&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_integer</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">model_number_map</span><span class="p">:</span>
                    <span class="n">type_val</span> <span class="o">=</span> <span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">model_number_map</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;sip.phone.deviceid&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;sip.phone.deviceid&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_integer</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">device_id_map</span><span class="p">:</span>
                    <span class="n">type_val</span> <span class="o">=</span> <span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">device_id_map</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;skinny.phone.devicetype&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s1">&#39;skinny.phone.devicetype&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_integer</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">skinny_device_type_map</span><span class="p">:</span>
                    <span class="n">type_val</span> <span class="o">=</span> <span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">skinny_device_type_map</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">type_val</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hardware</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hardware</span><span class="p">,</span> <span class="n">type_val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setup_camelot_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Initializing Camelot Endpoint...&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">namespace</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;could not create endpoint object&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">namespace</span><span class="o">.</span><span class="n">config_ep_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_params</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Failed to configure all parameters during &#39;</span>
                        <span class="s1">&#39;initialization: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_config_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_configure_endpoint</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_register</span><span class="p">:</span>
            <span class="n">namespace</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
            <span class="n">namespace</span><span class="o">.</span><span class="n">inservice</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_to_register</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Waiting for the endpoint: [</span><span class="si">%r</span><span class="s1">] inservice state&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="p">))</span>

                <span class="k">def</span> <span class="nf">_is_registered</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">namespace</span><span class="o">.</span><span class="n">get_info</span><span class="p">()[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inservice&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">timing</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
                        <span class="n">_is_registered</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">inservice_timeout</span><span class="p">,</span>
                        <span class="n">interval</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">raise_msg</span><span class="o">=</span><span class="s1">&#39;timed out waiting for&#39;</span>
                                              <span class="s1">&#39; in-service&#39;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Endpoint in-service failed, Info: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">namespace</span><span class="o">.</span><span class="n">get_info</span><span class="p">()))</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;cleaning camelot endpoint&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">camelot_endpoint_clean_exit</span><span class="p">()</span>
                    <span class="k">raise</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Initialized Camelot Endpoint&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_config_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf_param</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;camelot_ep_template_file&#39;</span> <span class="ow">in</span> <span class="n">conf_param</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;camelot_ep_template_file:&quot;</span>
                      <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">conf_param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;camelot_ep_template_file&#39;</span><span class="p">)))</span>
            <span class="kn">import</span> <span class="nn">imp</span>
            <span class="kn">import</span> <span class="nn">os</span>
            <span class="n">camelot_config_file</span> <span class="o">=</span> <span class="n">conf_param</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;camelot_ep_template_file&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">camelot_config_file</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="n">camelot_config_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.py&#39;</span><span class="p">):</span>
                <span class="n">template_obj</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_source</span><span class="p">(</span><span class="s2">&quot;camelot_config&quot;</span><span class="p">,</span>
                                               <span class="n">camelot_config_file</span><span class="p">)</span>
                <span class="n">phones_dict</span> <span class="o">=</span> <span class="n">template_obj</span><span class="o">.</span><span class="n">phones_camelot_params</span>
                <span class="n">features_dict</span> <span class="o">=</span> <span class="n">template_obj</span><span class="o">.</span><span class="n">features_camelot_params</span>
                <span class="k">del</span> <span class="n">conf_param</span><span class="p">[</span><span class="s1">&#39;camelot_ep_template_file&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;File not found:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">camelot_config_file</span><span class="p">))</span>
                <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Fetching phone models from &quot;</span>
                      <span class="s2">&quot;camelot-pi/camelot_param_template.&quot;</span><span class="p">)</span>
            <span class="n">phones_dict</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">phones_camelot_params</span>
            <span class="n">features_dict</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">features_camelot_params</span>
        <span class="k">if</span> <span class="s1">&#39;phone_model&#39;</span> <span class="ow">in</span> <span class="n">conf_param</span><span class="p">:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">conf_param</span><span class="p">[</span><span class="s1">&#39;phone_model&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">phones_dict</span><span class="p">:</span>
                <span class="n">phone_dict</span> <span class="o">=</span> <span class="n">phones_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">phone_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conf_param</span><span class="p">:</span>
                        <span class="n">conf_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Phone model: </span><span class="si">{}</span><span class="s2"> not defined in &quot;</span>
                         <span class="s2">&quot;camelot_param_template file.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">conf_param</span><span class="p">[</span><span class="s1">&#39;phone_model&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;add_feature&#39;</span> <span class="ow">in</span> <span class="n">conf_param</span><span class="p">:</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">conf_param</span><span class="p">[</span><span class="s1">&#39;add_feature&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">feature</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">features_dict</span><span class="p">:</span>
                        <span class="n">feature_dict</span> <span class="o">=</span> <span class="n">features_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">feature_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conf_param</span><span class="p">:</span>
                                <span class="n">conf_param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Feature: </span><span class="si">{}</span><span class="s2"> not defined in &quot;</span>
                                 <span class="s2">&quot;camelot_param_template file.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">del</span> <span class="n">conf_param</span><span class="p">[</span><span class="s1">&#39;add_feature&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">conf_param</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Modified Config:</span><span class="si">{}</span><span class="s2"> </span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_mac</span><span class="p">,</span>
                                                           <span class="n">conf_param</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_check_target_match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_ip</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_port</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exec_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_port</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;VAPIEI&#39;</span> <span class="ow">in</span> <span class="n">result</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addrs</span><span class="o">.</span><span class="n">_default_mode</span> <span class="o">!=</span> <span class="s1">&#39;camelot_server&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_exec_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">)))</span>
            <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s1">&#39;cv&#39;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Camelot endpoint failed to connect: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_validate_dict_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dict_arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dict_arg</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">dict_arg</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">dict_arg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dict_arg</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">dict_arg</span><span class="p">)</span> <span class="o">==</span> <span class="n">OrderedDict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_config_param</span><span class="p">(</span><span class="n">dict_arg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dict_arg</span>

    <span class="k">def</span> <span class="nf">_is_valid_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">is_valid_ipv4</span><span class="p">(</span>
                <span class="n">ip</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">VAPIEIUtils</span><span class="o">.</span><span class="n">is_valid_ipv6_address</span><span class="p">(</span>
                <span class="n">ip</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">_validate_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TODO: throw exception here</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_ip</span> <span class="o">==</span> <span class="s1">&#39;0.0.0.0&#39;</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_ip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_ip</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not a valid camelot server ip[</span><span class="si">%s</span><span class="s1">]&#39;</span>
                          <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_ip</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_port</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Camelot port is not a valid integer&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_params</span>
            <span class="c1"># TODO Detailed verification of parameters by maintaining a list</span>
            <span class="k">if</span> <span class="s1">&#39;sip.phone.tftpip&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_ip</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;sip.phone.tftpip&#39;</span><span class="p">)):</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not a valid TFTP IP in config parameters&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sip.phone.deviceid&#39;</span><span class="p">),</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;DEVICE_ID is not a valid integer&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;sip.phone.ip&#39;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_ip</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;sip.phone.ip&#39;</span><span class="p">)):</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Not a valid PHONE_IP in config parameters&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Un expected exception while _validate_args(): &#39;</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">get_ipv6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the ipv6 address for the device.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">camelot_ipv6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_info</span><span class="p">()[</span><span class="s1">&#39;ipv6address&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">camelot_ipv6</span><span class="p">:</span>
            <span class="n">camelot_ipv6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_mac</span>
        <span class="k">return</span> <span class="n">camelot_ipv6</span>

    <span class="k">def</span> <span class="nf">get_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Returns the ipv4 address for the device.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">camelot_ipv4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_info</span><span class="p">()[</span><span class="s1">&#39;ipv4address&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">camelot_ipv4</span><span class="p">:</span>
            <span class="n">camelot_ipv4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_mac</span>
        <span class="k">return</span> <span class="n">camelot_ipv4</span>

    <span class="k">def</span> <span class="nf">get_feedback_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">CamlotFeedbackHandler</span>

    <span class="k">def</span> <span class="nf">get_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="s1">&#39;sip&#39;</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">e164</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="o">==</span> <span class="s1">&#39;cas&#39;</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;its cas endpoint is </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_lines</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Empty get_lines output, no associated DN found&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">primary_line</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">primary_line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_address&#39;</span><span class="p">):</span>
            <span class="n">full_address</span> <span class="o">=</span> <span class="n">primary_line</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_address&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Line does not have attribute &quot;full_address&quot; &#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;@&#39;</span> <span class="ow">in</span> <span class="n">full_address</span><span class="p">:</span>
                <span class="n">ep_dn</span> <span class="o">=</span> <span class="n">full_address</span><span class="p">[:</span><span class="n">full_address</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ep_dn</span> <span class="o">=</span> <span class="n">full_address</span>
            <span class="k">return</span> <span class="n">ep_dn</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No DN allocated to the Endpoint&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_version_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_device_info</span><span class="p">()</span>
        <span class="k">return</span> <span class="s1">&#39;CamelotEP </span><span class="si">{version}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Version&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_device_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Fetches the Device Basic information &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;DeviceInfo&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_system_name</span><span class="p">(),</span>
                <span class="s1">&#39;PhoneDN&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number</span><span class="p">(),</span>
                <span class="s1">&#39;Version&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cli_version</span><span class="p">,</span>
                <span class="s1">&#39;MAC Address&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_mac</span><span class="p">,</span>
                <span class="s1">&#39;Model Name&#39;</span><span class="p">:</span> <span class="s1">&#39;Camelot Endpoint&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Camelot Server ip&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_ip</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_system_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the name of the device, e.g.</span>
<span class="sd">        ``&#39;SEPBAACBAAC7001&#39;``&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_mac</span>

    <span class="k">def</span> <span class="nf">log_to_device</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_mac_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the MAC address for the device.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_mac</span>

    <span class="k">def</span> <span class="nf">dial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Instruct the endpoint device to dial another endpoint device</span>
<span class="sd">        (the receiver) under the control of TNG pi. Protocol can be a string</span>
<span class="sd">        containing the word &#39;to&#39;, such as &#39;h323tosip&#39;, in which case we will</span>
<span class="sd">        try to establish an interworked call.</span>

<span class="sd">        The should_fail parameter is used to change the behaviour of the method</span>
<span class="sd">        in the case where we expect a call to fail. If should_fail is True and</span>
<span class="sd">        the call does indeed fail we swallow the CallError the failure raises</span>
<span class="sd">        and do not note the failure on the backend. If the call unexpectedly</span>
<span class="sd">        connects, we raise an AssertionError. If should_fail is False (ult)</span>
<span class="sd">        dial behaviour is completely normal.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dial</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dial_device_with_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">interface_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dial_device_with_alias</span><span class="p">(</span>
            <span class="n">receiver</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">interface_name</span><span class="o">=</span><span class="n">interface_name</span><span class="p">,</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">dial_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">dial_alias</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">answer_incoming</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">otherside</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">answer_incoming</span><span class="p">(</span>
            <span class="n">otherside</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">blind_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transferee</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">blind_transfer</span><span class="p">(</span>
            <span class="n">transferee</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">blind_transfer_with_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transferee</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span>
                                  <span class="n">receiver_alias</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">blind_transfer_with_alias</span><span class="p">(</span>
            <span class="n">transferee</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">receiver_alias</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">consultative_transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transferee</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">consultative_transfer</span><span class="p">(</span>
            <span class="n">transferee</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">consultative_transfer_with_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">transferee</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span>
                                         <span class="n">receiver_alias</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">consultative_transfer_with_alias</span><span class="p">(</span>
            <span class="n">transferee</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">receiver_alias</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">join_ad_hoc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joinee1</span><span class="p">,</span> <span class="n">joinee2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join_ad_hoc</span><span class="p">(</span>
            <span class="n">joinee1</span><span class="p">,</span> <span class="n">joinee2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">join_ad_hoc_with_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">joinee1</span><span class="p">,</span> <span class="n">joinee2</span><span class="p">,</span> <span class="n">joinee2_alias</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audio_only&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;audio_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">audio_only</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">join_ad_hoc_with_alias</span><span class="p">(</span>
            <span class="n">joinee1</span><span class="p">,</span> <span class="n">joinee2</span><span class="p">,</span> <span class="n">joinee2_alias</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_model_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This method returns the Model number of the IOS device</span>
<span class="sd">        &#39;&#39;&#39;</span> <span class="s1">&#39;&#39;&#39;Change this in future TO-DO&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;Camelot Endpoint&#39;</span>

    <span class="k">def</span> <span class="nf">_pre_deactivation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Overriden method. Stops the test case execution and puts the</span>
<span class="sd">         endpoint out of service</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Camelot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_pre_deactivation</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camelot_endpoint_clean_exit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">):</span>
        <span class="n">ep_log_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">ep_log_dir</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;directory&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ep_sipx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">ep_log_file_prefix</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;file_prefix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">log_dir</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">):</span>
            <span class="n">log_dir</span> <span class="o">=</span> <span class="n">log_dir</span> <span class="o">+</span> <span class="n">ep_sipx</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_dir</span> <span class="o">=</span> <span class="n">log_dir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">ep_sipx</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ip</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;camelot ep log: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">log_dir</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scp</span><span class="o">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">ep_log_dir</span><span class="p">,</span> <span class="n">topath</span><span class="o">=</span><span class="n">log_dir</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_outofservice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_info</span><span class="p">()[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;outofservice&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">camelot_endpoint_clean_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Stops camelot endpoint on the server side.</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;in camelot_endpoint_clean_exit...&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_info</span><span class="p">()[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inservice&#39;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">disconnect_all</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Failed to call disconnect_all &#39;</span>
                                  <span class="s1">&#39;during cleanup&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">out_of_service</span><span class="p">()</span>
                <span class="n">tng</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">is_outofservice</span><span class="p">,</span>
                              <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                              <span class="n">raise_on_timeout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">uninit_ep</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ep_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;sipx&#39;</span><span class="p">,</span> <span class="s1">&#39;tandbergsip&#39;</span><span class="p">,</span> <span class="s1">&#39;siptrunk&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_release_ep</span><span class="p">()</span>
            <span class="n">serv</span> <span class="o">=</span> <span class="n">camelot</span><span class="o">.</span><span class="n">get_camelot_server</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam_ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam_port</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">serv</span><span class="p">:</span>
                <span class="n">serv</span><span class="o">.</span><span class="n">_tng_cleanup_required</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_sip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Checks if the phone is a Sip phone&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_media</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_id</span><span class="p">):</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">CallMedia</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
        <span class="n">streams_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_streams</span><span class="p">()</span>
        <span class="n">call_ref</span> <span class="o">=</span> <span class="n">call_id</span>
        <span class="n">call_id_streams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">call_ref</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">streams_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;StrmID&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
                    <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StrmID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;stream_ref&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;CallId&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
                    <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;CallId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;call_ref&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s1">&#39;Type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
                    <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
                <span class="n">stream_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_stream_info</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StrmID&#39;</span><span class="p">])</span>
                <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;RemoteAddr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;address&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;open&#39;</span><span class="p">:</span>
                        <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StreamStatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Active&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StreamStatus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Not Ready&#39;</span>
                <span class="k">if</span> <span class="n">stream</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inbound&#39;</span><span class="p">:</span>
                        <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Rx&#39;</span>
                        <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;RcvrCodec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;codec&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;outbound&#39;</span><span class="p">:</span>
                        <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tx&#39;</span>
                        <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;SenderCodec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;codec&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">streams_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StreamStatus&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Active&#39;</span><span class="p">:</span>
                    <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;CallId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;CallId&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">call_ref</span> <span class="o">=</span> <span class="n">call_ref</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;CallId&#39;</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">call_ref</span><span class="p">,</span> <span class="mi">16</span><span class="p">):</span>
                        <span class="n">call_id_streams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">call_id_streams</span><span class="p">:</span>
                <span class="n">call_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_call_info</span><span class="p">(</span><span class="n">call_ref</span><span class="p">)</span>
                <span class="n">cm</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_audio_in</span><span class="p">(</span><span class="n">call_id_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">))</span>
                <span class="n">cm</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_audio_out</span><span class="p">(</span><span class="n">call_id_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">))</span>
                <span class="n">video_chns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_video_in</span><span class="p">(</span><span class="n">call_id_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">chn</span> <span class="ow">in</span> <span class="n">video_chns</span><span class="p">:</span>
                    <span class="n">cm</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">chn</span><span class="p">)</span>
                <span class="n">video_chns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_video_out</span><span class="p">(</span><span class="n">call_id_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">chn</span> <span class="ow">in</span> <span class="n">video_chns</span><span class="p">:</span>
                    <span class="n">cm</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">chn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cm</span>

    <span class="k">def</span> <span class="nf">_create_audio_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">,</span> <span class="n">media_direc</span><span class="p">):</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="n">CiscoPhoneAudioChannel</span><span class="p">()</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">AUDIO</span>
        <span class="n">stream_active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">call_streams</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StreamStatus&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Not Ready&#39;</span> <span class="ow">and</span>
                    <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;audio&#39;</span><span class="p">):</span>
                <span class="n">stream_active</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">stream_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_stream_info</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StrmID&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">media_direc</span> <span class="o">==</span> <span class="n">media</span><span class="o">.</span><span class="n">INCOMING</span><span class="p">:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;RcvrCodec&#39;</span><span class="p">]</span>
                    <span class="n">str_ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_stream_info_ext</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StrmID&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">str_ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;packets received&#39;</span><span class="p">):</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="n">str_ext</span><span class="p">[</span><span class="s1">&#39;packets received&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;SenderCodec&#39;</span><span class="p">]</span>
                    <span class="n">str_ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_stream_info_ext</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StrmID&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">str_ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;packets sent&#39;</span><span class="p">):</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="n">str_ext</span><span class="p">[</span><span class="s1">&#39;packets sent&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;transport&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;srtp&#39;</span><span class="p">:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stream_active</span><span class="p">:</span>
                <span class="n">sec_state</span> <span class="o">=</span> <span class="n">call_details</span><span class="p">[</span><span class="s1">&#39;call security status&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">sec_state</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="s1">&#39;not authenticated&#39;</span><span class="p">]:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">sec_state</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;authenticated&#39;</span><span class="p">,</span> <span class="s1">&#39;encrypted&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;secured media&#39;</span><span class="p">]:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">MAIN</span>
        <span class="n">channel</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="n">channel</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">channel</span>

    <span class="k">def</span> <span class="nf">_get_audio_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">):</span>
        <span class="n">send_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">call_streams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Rx&#39;</span><span class="p">:</span>
                <span class="n">send_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">send_list</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_audio_channel</span><span class="p">(</span><span class="n">send_list</span><span class="p">,</span> <span class="n">call_details</span><span class="p">,</span>
                                           <span class="n">media</span><span class="o">.</span><span class="n">INCOMING</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">INCOMING</span>
            <span class="n">c</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">c</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No inbound stream on Camelot endpoint&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_audio_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">):</span>
        <span class="n">send_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">call_streams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Tx&#39;</span><span class="p">:</span>
                <span class="n">send_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">send_list</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_audio_channel</span><span class="p">(</span><span class="n">send_list</span><span class="p">,</span> <span class="n">call_details</span><span class="p">,</span>
                                           <span class="n">media</span><span class="o">.</span><span class="n">OUTGOING</span><span class="p">)</span>
            <span class="n">c</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">OUTGOING</span>
            <span class="n">c</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">c</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No outbound stream on Camelot endpoint&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_video_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_stream</span><span class="p">,</span> <span class="n">call_details</span><span class="p">,</span> <span class="n">media_direc</span><span class="p">):</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stream_active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">video_active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">call_stream</span><span class="p">:</span>
            <span class="n">stream_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_stream_info</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StrmID&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StreamStatus&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;Not Ready&#39;</span> <span class="ow">and</span>
                    <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;video&#39;</span><span class="p">):</span>
                <span class="n">channel</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;slides&#39;</span><span class="p">:</span>
                    <span class="n">channel</span> <span class="o">=</span> <span class="n">CamelotPresentationChannel</span><span class="p">()</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">PRESENTATION</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">channel</span> <span class="o">=</span> <span class="n">CiscoPhoneVideoChannel</span><span class="p">()</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">role</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">MAIN</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">media_type</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">VIDEO</span>
                <span class="n">stream_active</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">video_active</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">media_direc</span> <span class="o">==</span> <span class="n">media</span><span class="o">.</span><span class="n">INCOMING</span><span class="p">:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;RcvrCodec&#39;</span><span class="p">]</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">FrameRate</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;frame rate&#39;</span><span class="p">]</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">ResolutionX</span> <span class="o">=</span> <span class="n">stream_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;picture format customXMax&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">ResolutionY</span> <span class="o">=</span> <span class="n">stream_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;picture format customYMax&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">str_ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_stream_info_ext</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StrmID&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">str_ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;packets received&#39;</span><span class="p">):</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="n">str_ext</span><span class="p">[</span><span class="s1">&#39;packets received&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;SenderCodec&#39;</span><span class="p">]</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">FrameRate</span> <span class="o">=</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;frame rate&#39;</span><span class="p">]</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">ResolutionX</span> <span class="o">=</span> <span class="n">stream_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;picture format customXMax&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">ResolutionY</span> <span class="o">=</span> <span class="n">stream_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s1">&#39;picture format customYMax&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">str_ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_stream_info_ext</span><span class="p">(</span><span class="n">stream</span><span class="p">[</span><span class="s1">&#39;StrmID&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">str_ext</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;packets sent&#39;</span><span class="p">):</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="n">str_ext</span><span class="p">[</span><span class="s1">&#39;packets sent&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">packet_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">stream_info</span><span class="p">[</span><span class="s1">&#39;transport&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;srtp&#39;</span><span class="p">:</span>
                    <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">stream_active</span> <span class="ow">and</span> <span class="n">video_active</span><span class="p">:</span>
                        <span class="n">sec_state</span> <span class="o">=</span> <span class="n">call_details</span><span class="p">[</span><span class="s1">&#39;call security status&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">sec_state</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="s1">&#39;not authenticated&#39;</span><span class="p">]:</span>
                            <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">elif</span> <span class="n">sec_state</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;authenticated&#39;</span><span class="p">,</span> <span class="s1">&#39;encrypted&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;secured media&#39;</span><span class="p">]:</span>
                            <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">channel</span><span class="o">.</span><span class="n">encryption</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">channel</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="n">channel</span><span class="o">.</span><span class="n">media_type</span><span class="p">)</span>
                <span class="n">channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">channels</span>

    <span class="k">def</span> <span class="nf">_get_video_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">):</span>
        <span class="n">send_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">call_streams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Rx&#39;</span><span class="p">:</span>
                <span class="n">send_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">send_list</span><span class="p">:</span>
            <span class="n">chns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_video_channel</span><span class="p">(</span><span class="n">send_list</span><span class="p">,</span> <span class="n">call_details</span><span class="p">,</span>
                                              <span class="n">media</span><span class="o">.</span><span class="n">INCOMING</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chns</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">INCOMING</span>
                <span class="n">c</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">chns</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No inbound stream on Camelot endpoint&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_video_out</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_streams</span><span class="p">,</span> <span class="n">call_details</span><span class="p">):</span>
        <span class="n">send_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="n">call_streams</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stream</span><span class="p">[</span><span class="s1">&#39;Direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Tx&#39;</span><span class="p">:</span>
                <span class="n">send_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">send_list</span><span class="p">:</span>
            <span class="n">chns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_video_channel</span><span class="p">(</span><span class="n">send_list</span><span class="p">,</span> <span class="n">call_details</span><span class="p">,</span>
                                              <span class="n">media</span><span class="o">.</span><span class="n">OUTGOING</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">chns</span><span class="p">:</span>
                <span class="n">c</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">OUTGOING</span>
                <span class="n">c</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">direction</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">chns</span>
        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;No outbound stream on Camelot endpoint&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgobj</span><span class="p">,</span> <span class="n">ip</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">createmsg</span> <span class="o">=</span> <span class="s1">&#39;sendrawmsg </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">@&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">msgobj</span><span class="o">.</span><span class="n">msgid</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
            <span class="n">hex_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_get_message_length_hex</span><span class="p">(</span><span class="n">createmsg</span><span class="p">)</span>
            <span class="n">rawmessage</span> <span class="o">=</span> <span class="s1">&#39;m:</span><span class="si">{0}</span><span class="s1">:</span><span class="si">{1}</span><span class="s1">:</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">ep_id</span><span class="p">,</span> <span class="n">hex_len</span><span class="p">,</span> <span class="n">createmsg</span><span class="p">)</span>
            <span class="n">with_new_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_camelot_query</span><span class="p">(</span><span class="n">rawmessage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_new_line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">with_new_line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Send message failed&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;send_message failed reason:&#39;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;send_message request failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">fill_parm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgobj</span><span class="p">):</span>
        <span class="n">fillparm</span> <span class="o">=</span> <span class="s1">&#39;fillrawparms </span><span class="si">{0}</span><span class="s1">@&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msgobj</span><span class="o">.</span><span class="n">msgid</span><span class="p">)</span>
        <span class="n">hex_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_get_message_length_hex</span><span class="p">(</span><span class="n">fillparm</span><span class="p">)</span>
        <span class="n">rawmessage</span> <span class="o">=</span> <span class="s1">&#39;m:</span><span class="si">{0}</span><span class="s1">:</span><span class="si">{1}</span><span class="s1">:</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">ep_id</span><span class="p">,</span>
                                            <span class="n">hex_len</span><span class="p">,</span> <span class="n">fillparm</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">with_new_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_camelot_query</span><span class="p">(</span><span class="n">rawmessage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_new_line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">with_new_line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Fill Parm failed&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;fill_parm request failed&#39;</span><span class="p">)</span>
            <span class="k">return</span>

<div class="viewcode-block" id="Camelot.start_raw_event"><a class="viewcode-back" href="../../../api/raweventcommands.html#camelot.tngdevice.camelot_endpoint.Camelot.start_raw_event">[docs]</a>    <span class="k">def</span> <span class="nf">start_raw_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_back</span><span class="p">,</span> <span class="n">event_sub_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="n">callid_filter</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">method_filter</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span>
                        <span class="n">cseq_filter</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">assist</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Registers the event call back on the endpoint for the perticular</span>
<span class="sd">        requested event. Once the event has occured, the call back</span>
<span class="sd">        function will be invoked.</span>
<span class="sd">        From call back user will get event_object from there, user</span>
<span class="sd">        can get msgObj()as shown below</span>

<span class="sd">        NOTE: This API can be used for Simulated Endpoints as well.</span>
<span class="sd">              i.e., the endpoint need not to be RawEndpoint.</span>

<span class="sd">        :parameter station_call_back: call back function to get event_object</span>
<span class="sd">        :parameter event_sub_type: event sub type</span>
<span class="sd">        :parameter callid_filter: callid filter</span>
<span class="sd">        :parameter method_filter: method filter</span>
<span class="sd">        :parameter cseq_filter: cseq filter</span>
<span class="sd">        :parameter assist: &#39;1&#39; -parse msg at sip stack, &#39;0&#39;- no parse</span>
<span class="sd">        :returns: None</span>

<span class="sd">        Example:</span>
<span class="sd">              To get any 200 OK INVITE event</span>

<span class="sd">        &gt;&gt;&gt; self.ep1.start_raw_event(self.station_call_back, method_filter=</span>
<span class="sd">                                 &#39;200 OK&#39;,cseq_filter=&#39;INVITE&#39;, assist=1)</span>

<span class="sd">        &gt;&gt;&gt; Where in definition of call back</span>
<span class="sd">        &gt;&gt;&gt; station_call_back(self, event_object=None):</span>
<span class="sd">        &gt;&gt;&gt; if not event_object:</span>
<span class="sd">        &gt;&gt;&gt;     log.info(&#39;Event Object is Null&#39;)</span>
<span class="sd">        &gt;&gt;&gt; else:</span>
<span class="sd">        &gt;&gt;&gt;     msgObj = event_object[&#39;msgid&#39;]</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;rawevent&#39;</span>
        <span class="k">if</span> <span class="n">event_sub_type</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">event_sub</span> <span class="o">=</span> <span class="n">event_sub_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">callid_filter</span> <span class="o">=</span> <span class="n">event_sub</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">method_filter</span> <span class="o">=</span> <span class="n">event_sub</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">cseq_filter</span> <span class="o">=</span> <span class="s1">&#39;NONE&#39;</span>

        <span class="n">event_sub_type1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">,</span><span class="si">{1}</span><span class="s1">,</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">callid_filter</span><span class="p">,</span>
                                               <span class="n">method_filter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">),</span>
                                               <span class="n">cseq_filter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">register_to_event</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">event_sub_type1</span><span class="p">,</span> <span class="n">call_back</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">start_raw_events</span><span class="p">(</span>
            <span class="n">callid_filter</span><span class="p">,</span> <span class="n">method_filter</span><span class="p">,</span> <span class="n">cseq_filter</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">assist</span><span class="p">))</span></div>

<div class="viewcode-block" id="Camelot.stop_raw_event"><a class="viewcode-back" href="../../../api/raweventcommands.html#camelot.tngdevice.camelot_endpoint.Camelot.stop_raw_event">[docs]</a>    <span class="k">def</span> <span class="nf">stop_raw_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_back</span><span class="p">,</span> <span class="n">event_sub_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">callid_filter</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">method_filter</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span>
                       <span class="n">cseq_filter</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">assist</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Un-registers the event call back on the endpoint, which it is</span>
<span class="sd">        registered using start_raw_event. parameters are same as start</span>

<span class="sd">        NOTE: This API can be used for Simulated Endpoints as well.</span>
<span class="sd">              i.e., the endpoint need not to be RawEndpoint.</span>

<span class="sd">        :parameter station_call_back: call back function to get event_object</span>
<span class="sd">        :parameter event_sub_type: event sub type</span>
<span class="sd">        :parameter callid_filter: callid filter</span>
<span class="sd">        :parameter method_filter: method filter</span>
<span class="sd">        :parameter cseq_filter: cseq filter</span>
<span class="sd">        :parameter assist: &#39;1&#39; -parse msg at sip stack, &#39;0&#39;- no parse</span>

<span class="sd">        :returns: None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">stop_raw_events</span><span class="p">(</span><span class="n">callid_filter</span><span class="p">,</span> <span class="n">method_filter</span><span class="p">,</span> <span class="n">cseq_filter</span><span class="p">,</span>
                                  <span class="nb">str</span><span class="p">(</span><span class="n">assist</span><span class="p">))</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;rawevent&#39;</span>
        <span class="n">event_sub_type1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">,</span><span class="si">{1}</span><span class="s1">,</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">callid_filter</span><span class="p">,</span>
                                               <span class="n">method_filter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">),</span>
                                               <span class="n">cseq_filter</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">unregister_event</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">event_sub_type1</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camelot.apply_out_action_set"><a class="viewcode-back" href="../../../api/raweventcommands.html#camelot.tngdevice.camelot_endpoint.Camelot.apply_out_action_set">[docs]</a>    <span class="k">def</span> <span class="nf">apply_out_action_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actionset</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">cseq</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This is used for addition, modification or removal of headers to any</span>
<span class="sd">        outgoing SIP message.</span>

<span class="sd">        :parameter actionset: out action object to be applied to endpoint.</span>
<span class="sd">        :parameter method: method filter</span>
<span class="sd">        :parameter cseq: cseq filter</span>

<span class="sd">        :returns: &#39;success&#39; or &#39;failure&#39;</span>

<span class="sd">        &gt;&gt;&gt; ep1.apply_out_action_set(out_action_Obj, method=&#39;INVITE&#39;)</span>
<span class="sd">        &#39;success&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msgid</span> <span class="o">=</span> <span class="n">actionset</span><span class="o">.</span><span class="n">msgid</span>
        <span class="n">outmsg</span> <span class="o">=</span> <span class="s1">&#39;mergemessage </span><span class="si">{0}</span><span class="se">\n</span><span class="si">{1}</span><span class="se">\n</span><span class="si">{2}</span><span class="s1">@&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msgid</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">cseq</span><span class="p">)</span>
        <span class="n">hex_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_get_message_length_hex</span><span class="p">(</span><span class="n">outmsg</span><span class="p">)</span>
        <span class="n">rawmessage</span> <span class="o">=</span> <span class="s1">&#39;m:</span><span class="si">{0}</span><span class="s1">:</span><span class="si">{1}</span><span class="s1">:</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">ep_id</span><span class="p">,</span> <span class="n">hex_len</span><span class="p">,</span>
                                            <span class="n">outmsg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">actionset</span><span class="o">.</span><span class="n">event_type</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">register_to_event</span><span class="p">(</span><span class="n">actionset</span><span class="o">.</span><span class="n">event_type</span><span class="p">,</span>
                                        <span class="n">actionset</span><span class="o">.</span><span class="n">event_sub_type</span><span class="p">,</span>
                                        <span class="n">actionset</span><span class="o">.</span><span class="n">call_back</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">with_new_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_camelot_query</span><span class="p">(</span><span class="n">rawmessage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_new_line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">with_new_line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;apply_action_set failed&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;apply_action_set request failed&#39;</span><span class="p">)</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="Camelot.remove_out_action_set"><a class="viewcode-back" href="../../../api/raweventcommands.html#camelot.tngdevice.camelot_endpoint.Camelot.remove_out_action_set">[docs]</a>    <span class="k">def</span> <span class="nf">remove_out_action_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actionset</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">cseq</span><span class="o">=</span><span class="s1">&#39;NONE&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This is used for removal of out_action_set linked to endpoint.</span>
<span class="sd">        This should contain same param values as in apply_out_action_set.</span>

<span class="sd">        :parameter actionset: out action object to be applied to endpoint.</span>
<span class="sd">        :parameter method: method filter</span>
<span class="sd">        :parameter cseq: cseq filter</span>

<span class="sd">        :returns: &#39;success&#39; or &#39;failure&#39;</span>

<span class="sd">        &gt;&gt;&gt; ep1.apply_out_action_set(out_action_Obj, method=&#39;INVITE&#39;)</span>
<span class="sd">        &#39;success&#39;.</span>
<span class="sd">        &gt;&gt;&gt; ep1.remove_out_action_set(out_action_Obj, method=&#39;INVITE&#39;)</span>
<span class="sd">        &#39;success&#39;.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">msgid</span> <span class="o">=</span> <span class="n">actionset</span><span class="o">.</span><span class="n">msgid</span>
        <span class="n">outmsg</span> <span class="o">=</span> <span class="s1">&#39;removemergemessage </span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1"> </span><span class="si">{2}</span><span class="s1">@&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msgid</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span>
                                                          <span class="n">cseq</span><span class="p">)</span>
        <span class="n">hex_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_get_message_length_hex</span><span class="p">(</span><span class="n">outmsg</span><span class="p">)</span>

        <span class="n">rawmessage</span> <span class="o">=</span> <span class="s1">&#39;m:</span><span class="si">{0}</span><span class="s1">:</span><span class="si">{1}</span><span class="s1">:</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">ep_id</span><span class="p">,</span> <span class="n">hex_len</span><span class="p">,</span>
                                            <span class="n">outmsg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">with_new_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_camelot_query</span><span class="p">(</span><span class="n">rawmessage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_new_line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">with_new_line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;remove_action_set failed nul returned&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;remove_action_set request failed reason:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span></div>

<div class="viewcode-block" id="Camelot.create_in_action_object"><a class="viewcode-back" href="../../../api/raweventcommands.html#camelot.tngdevice.camelot_endpoint.Camelot.create_in_action_object">[docs]</a>    <span class="k">def</span> <span class="nf">create_in_action_object</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a blank set of verification as a place holder</span>
<span class="sd">        Then using different command one can keep on adding actions</span>
<span class="sd">        for veification of original message.</span>

<span class="sd">        NOTE: This API can be used for Simulated Endpoints as well.</span>
<span class="sd">              i.e., the endpoint need not to be RawEndpoint.</span>

<span class="sd">        &gt;&gt;&gt; inActionObj = create_in_action_set()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in create_in_action_object method&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_query_camelot</span><span class="p">(</span><span class="n">camelot</span><span class="o">.</span><span class="n">CREATE_TEMPLATE_MSG</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
                <span class="n">actionObj</span> <span class="o">=</span> <span class="n">InActionObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">actionObj</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">actionObj</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;create_in_action_object Failed=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camelot.remove_inaction_object"><a class="viewcode-back" href="../../../api/raweventcommands.html#camelot.tngdevice.camelot_endpoint.Camelot.remove_inaction_object">[docs]</a>    <span class="k">def</span> <span class="nf">remove_inaction_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inaction_obj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete the inaction object. Internally, inaction_obj gets</span>
<span class="sd">        deleted based on the msgid.</span>

<span class="sd">        :parameter inaction_obj: inaction_obj returned by</span>
<span class="sd">                                 verify_request_send_response().</span>

<span class="sd">        :returns: Upon success, True is returned. Orelse, Exception</span>
<span class="sd">                  is thrown from the Camelot.</span>

<span class="sd">        &gt;&gt;&gt; ep1.remove_inaction_object(inaction_obj)</span>
<span class="sd">            True</span>
<span class="sd">        &gt;&gt;&gt; ep1.remove_inaction_object(inaction_obj)</span>
<span class="sd">            CamelotError: No match found</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in remove_inaction_object method&quot;</span><span class="p">)</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;verifyevent&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inaction_obj</span><span class="p">,</span> <span class="n">InActionObject</span><span class="p">):</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;invalid inaction object passed&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inaction_obj</span><span class="o">.</span><span class="n">sub_type</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">unregister_event</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">inaction_obj</span><span class="o">.</span><span class="n">sub_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_query_camelot</span><span class="p">(</span>
            <span class="n">camelot</span><span class="o">.</span><span class="n">REMOVE_INACTION_OBJ</span><span class="p">,</span> <span class="n">inaction_obj</span><span class="o">.</span><span class="n">msgid</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_validate_init_verify_req</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                  <span class="n">call_back</span><span class="p">,</span>
                                  <span class="n">req_method</span><span class="p">,</span>
                                  <span class="n">req_content_filter</span><span class="p">,</span>
                                  <span class="n">req_header_filter</span><span class="p">):</span>
        <span class="n">supported_methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;INVITE&#39;</span><span class="p">,</span> <span class="s1">&#39;UPDATE&#39;</span><span class="p">,</span> <span class="s1">&#39;REFER&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">req_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">supported_methods</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;incorrect method name passed!supported methods are:&quot;</span>
                      <span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">supported_methods</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;verifyevent&#39;</span>
        <span class="c1"># cseq is used to do a backward compatibility with</span>
        <span class="c1"># register_to_event.</span>
        <span class="n">cseq</span> <span class="o">=</span> <span class="n">req_method</span>
        <span class="n">sub_type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">,</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">req_method</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">),</span>
                                    <span class="n">cseq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>
        <span class="n">verifyobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_in_action_object</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verifyobj</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CamelotError</span><span class="p">(</span><span class="s2">&quot;in-action object creation failed&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">register_to_event</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">sub_type</span><span class="p">,</span> <span class="n">call_back</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CamelotError</span><span class="p">(</span><span class="s1">&#39;Failed to register_to_event in&#39;</span>
                               <span class="s1">&#39;verify_request_send_response,reason:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span>
                               <span class="nb">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">req_content_filter</span> <span class="ow">and</span> <span class="s1">&#39;Content-Type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req_header_filter</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CamelotError</span><span class="p">(</span><span class="s2">&quot;content_type needs to be given when&quot;</span>
                               <span class="s2">&quot; content_filter is specified&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">req_header_filter</span> <span class="ow">or</span> <span class="n">req_header_filter</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="n">req_header_filter</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">req_content_filter</span> <span class="ow">or</span> <span class="n">req_content_filter</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="n">req_content_filter</span> <span class="o">=</span> <span class="s1">&#39;ALL&#39;</span>
        <span class="n">verifyobj</span><span class="o">.</span><span class="n">sub_type</span> <span class="o">=</span> <span class="n">sub_type</span>
        <span class="k">return</span> <span class="n">verifyobj</span>

<div class="viewcode-block" id="Camelot.verify_request_send_response"><a class="viewcode-back" href="../../../api/raweventcommands.html#camelot.tngdevice.camelot_endpoint.Camelot.verify_request_send_response">[docs]</a>    <span class="k">def</span> <span class="nf">verify_request_send_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_back</span><span class="p">,</span>
                                     <span class="n">req_method</span><span class="p">,</span>
                                     <span class="n">req_header_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">req_content_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">resp_status_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">resp_reason_phrase</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                     <span class="n">resp_continue</span><span class="o">=</span><span class="s1">&#39;yes&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method allows to intercept the incoming SIP requests and</span>
<span class="sd">        alter their response. A callback method is registered internally,</span>
<span class="sd">        and once the filter matches the inbound SIP request in server, the</span>
<span class="sd">        callback method is invoked. This callback will be called for every</span>
<span class="sd">        SIP request that match, unless remove_inaction_object is called.</span>

<span class="sd">        :parameter call_back: call back method to be registered.</span>
<span class="sd">        :parameter req_method: This is the SIP request method to be matched.</span>
<span class="sd">         supported methods = [&#39;INVITE&#39;, &#39;UPDATE&#39;, &#39;REFER&#39;].</span>
<span class="sd">         It is a Mandatory parameter.</span>
<span class="sd">        :parameter req_header_filter: SIP headers to be matched.Default value</span>
<span class="sd">         is None. All incoming headers are accepted.</span>
<span class="sd">         eg - {&quot;MIME-Version&quot;:&quot;1.0&quot;, &quot;Content-Type&quot;:&quot;multipart/mixed;</span>
<span class="sd">         boundary=uniqueBoundary&quot;}</span>
<span class="sd">        :parameter req_content_filter: This is the SIP sub-content-type to be</span>
<span class="sd">         matched. Default value is None, accepts anything coming inside the</span>
<span class="sd">         body.eg - {&quot;application/x-cisco-remotecc-cm+xml&quot;:[</span>
<span class="sd">         &quot;&lt;ExecuteItem URL&quot;, &quot;RTPMTx:Play&quot;]}, matches the sub-content-type</span>
<span class="sd">         inside the xml body, sets filter and triggers the callback once SIP</span>
<span class="sd">         message is received.</span>
<span class="sd">         values possible:\n</span>
<span class="sd">         * Default: None. Accepts anything in incoming SIP message&#39;s body.</span>
<span class="sd">         * set filter for multipart/mixed: {SUB-CONTENT-TYPE:</span>
<span class="sd">           [&#39;string1&#39;,&#39;string2&#39;]}.\n</span>
<span class="sd">           eg - {&quot;application/x-cisco-remotecc-cm+xml&quot;:[</span>
<span class="sd">           &quot;&lt;ExecuteItem URL&quot;, &quot;RTPMTx:Play&quot;]}. Matches the SUB-CONTENT-TYPE</span>
<span class="sd">           and strings in its boundary.\n</span>
<span class="sd">         * set filter for other content-types:\n</span>
<span class="sd">           {&quot;application/sdp&quot;:[&quot;media&quot;]}. Matches strings in the entire body.</span>
<span class="sd">         Note: If req_header_filter doesnot contain Content-Type, then setting</span>
<span class="sd">         req_content_filter will throw exception.\n</span>
<span class="sd">        :parameter resp_status_code: This is the response status code to the</span>
<span class="sd">         SIP request that has been captured. Default value is None. For None,</span>
<span class="sd">         the response is not altered. eg - &#39;202&#39;, &#39;200&#39;,etc...</span>
<span class="sd">        :parameter resp_status_phrase: This is the SIP response phrase to the</span>
<span class="sd">         SIP request that has been captured. Default value is None. For None,</span>
<span class="sd">         the response is not altered. eg - &#39;Accepted&#39;,&#39;OK&#39;,etc..</span>
<span class="sd">        :parameter resp_continue: This is the flag tells to the camelot that</span>
<span class="sd">         response should be sent or not after receiving the incoming request.</span>

<span class="sd">        :returns: Upon success, in-action object is returned. On Failure,</span>
<span class="sd">         Exception will be thrown.</span>

<span class="sd">        :Note: As of now, Camelot supports verify_request_send_response only</span>
<span class="sd">         for REFER and Notify scenario.</span>

<span class="sd">        &gt;&gt;&gt; in_action_valid_ep1</span>
<span class="sd">            = ep1.verify_request_send_response(</span>
<span class="sd">                            self.verify_CB_1,</span>
<span class="sd">                            req_method=&#39;REFER&#39;,</span>
<span class="sd">                            req_header_filter={&quot;MIME-Version&quot;:&quot;1.0&quot;, &quot;</span>
<span class="sd">                                    Content-Type&quot;:&quot;multipart/mixed;boundary=uniqueBoundary&quot;},</span>
<span class="sd">                            req_content_filter={&quot;application/x-cisco-remotecc-cm+xml&quot;:</span>
<span class="sd">                                    [&quot;&lt;ExecuteItem URL&quot;, &quot;RTPMTx:Play&quot;]},</span>
<span class="sd">                            resp_status_code=&#39;480&#39;,</span>
<span class="sd">                            resp_reason_phrase=&#39;Temporarily not availiable&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in method verify_request_send_response&quot;</span><span class="p">)</span>
        <span class="n">req_method</span> <span class="o">=</span> <span class="n">req_method</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">verifyobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_init_verify_req</span><span class="p">(</span><span class="n">call_back</span><span class="p">,</span>
                                                   <span class="n">req_method</span><span class="p">,</span>
                                                   <span class="n">req_content_filter</span><span class="p">,</span>
                                                   <span class="n">req_header_filter</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;header_filter&#39;</span><span class="p">:</span> <span class="n">req_header_filter</span><span class="p">,</span>
                  <span class="s1">&#39;msgid&#39;</span><span class="p">:</span> <span class="n">verifyobj</span><span class="o">.</span><span class="n">msgid</span><span class="p">,</span>
                  <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">req_method</span><span class="p">,</span>
                  <span class="s1">&#39;content_filter&#39;</span><span class="p">:</span> <span class="n">req_content_filter</span><span class="p">,</span>
                  <span class="s1">&#39;status_code&#39;</span><span class="p">:</span> <span class="n">resp_status_code</span><span class="p">,</span>
                  <span class="s1">&#39;reason_phrase&#39;</span><span class="p">:</span> <span class="n">resp_reason_phrase</span><span class="p">,</span>
                  <span class="s1">&#39;resp_continue&#39;</span><span class="p">:</span> <span class="n">resp_continue</span><span class="p">}</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in method verify_request_send_response&quot;</span>
                  <span class="s2">&quot;kwargs:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_query_camelot</span><span class="p">(</span><span class="n">camelot</span><span class="o">.</span><span class="n">VERIFY_REQ_SEND_RESP</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">verifyobj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;verify_request_send_resp failed camelot&#39;</span>
                      <span class="s1">&#39;returned null&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Camelot.send_request"><a class="viewcode-back" href="../../../api/raweventcommands.html#camelot.tngdevice.camelot_endpoint.Camelot.send_request">[docs]</a>    <span class="k">def</span> <span class="nf">send_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_handler</span><span class="p">,</span> <span class="n">subscription_handler</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span>
                     <span class="n">body_xml</span><span class="p">,</span> <span class="n">withsdp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method allows to send a customized SIP request.</span>
<span class="sd">        eg- Used to send a NOTIFY request once the callback is triggered</span>
<span class="sd">        by verify_request_send_response upon receiving  REFER request.</span>

<span class="sd">        :parameter call_handler: call_handler returned by the callback in</span>
<span class="sd">         msgObj[&#39;call_handler&#39;].</span>
<span class="sd">        :parameter subscription_handler: subscription_handler returned by the</span>
<span class="sd">         callback in msgObj[&#39;subscription_handler&#39;].</span>
<span class="sd">        :parameter method: SIP request method that has to be sent. eg-&#39;NOTIFY&#39;,</span>
<span class="sd">         &#39;INVITE&#39;, etc...</span>
<span class="sd">        :parameter body_xml: xml body to be sent along with the request.</span>
<span class="sd">         eg - &#39;&lt;tag1&gt;xmlbeingsent&lt;/tag1&gt;&#39;</span>
<span class="sd">        :parameter withsdp: Functionality not yet supported.</span>

<span class="sd">        :returns: Upon success, True is returned. On Failure,</span>
<span class="sd">         Exception will be thrown. Exceptions such as &quot;invalid CCB or</span>
<span class="sd">         SCB passed&quot;,&quot;request sending in camelot failed&quot; and</span>
<span class="sd">         &quot;internal error&quot;.</span>

<span class="sd">        :Note: As of now, Camelot supports verify_request_send_response only</span>
<span class="sd">         REFER and Notify scenario.</span>

<span class="sd">        &gt;&gt;&gt; in_action_valid_ep1</span>
<span class="sd">            = ep1.verify_request_send_response(</span>
<span class="sd">                            self.verify_CB_1,</span>
<span class="sd">                            req_method=&#39;REFER&#39;,</span>
<span class="sd">                            req_header_filter=&#39;{&quot;MIME-Version&quot;:&quot;1.0&quot;}&#39;,</span>
<span class="sd">                            req_content_type=&#39;XML&#39;,</span>
<span class="sd">                            req_content_filter=&#39;ALL&#39;,</span>
<span class="sd">                            resp_status_code=&#39;480&#39;,</span>
<span class="sd">                            resp_reason_phrase=&#39;Temporarily not available&#39;)</span>

<span class="sd">        &gt;&gt;&gt; def verify_CB_1(msg_obj):</span>
<span class="sd">                ep2.send_request(ccb = msgObj[&#39;call_handler&#39;],</span>
<span class="sd">                                 scb = msgObj[&#39;subscription_handler&#39;],</span>
<span class="sd">                                 method = &quot;NOTIFY&quot;,</span>
<span class="sd">                                 body_xml = &quot;with-xml-body&quot;,</span>
<span class="sd">                                 withsdp = &quot;with-sdp&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in method send_request&quot;</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ccb&#39;</span><span class="p">:</span> <span class="n">call_handler</span><span class="p">,</span>
                  <span class="s1">&#39;scb&#39;</span><span class="p">:</span> <span class="n">subscription_handler</span><span class="p">,</span>
                  <span class="s1">&#39;method&#39;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                  <span class="s1">&#39;body_xml&#39;</span><span class="p">:</span> <span class="n">body_xml</span><span class="p">,</span>
                  <span class="s1">&#39;withsdp&#39;</span><span class="p">:</span> <span class="n">withsdp</span><span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_query_camelot</span><span class="p">(</span><span class="n">camelot</span><span class="o">.</span><span class="n">SEND_RAW_REQUEST</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">start_verify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_back</span><span class="p">,</span> <span class="n">verifyobj</span><span class="p">,</span>
                           <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="n">cseq</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;verifyevent&#39;</span>
        <span class="n">sub_type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">,</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">),</span>
                                    <span class="n">cseq</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>
        <span class="n">msgid</span> <span class="o">=</span> <span class="n">verifyobj</span><span class="o">.</span><span class="n">msgid</span>
        <span class="n">outmsg</span> <span class="o">=</span> <span class="s1">&#39;startverifyevent </span><span class="si">{0}</span><span class="se">\n</span><span class="si">{1}</span><span class="se">\n</span><span class="si">{2}</span><span class="s1">@&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">msgid</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">cseq</span><span class="p">)</span>
        <span class="n">hex_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_get_message_length_hex</span><span class="p">(</span><span class="n">outmsg</span><span class="p">)</span>
        <span class="n">rawmessage</span> <span class="o">=</span> <span class="s1">&#39;m:</span><span class="si">{0}</span><span class="s1">:</span><span class="si">{1}</span><span class="s1">:</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">ep_id</span><span class="p">,</span> <span class="n">hex_len</span><span class="p">,</span> <span class="n">outmsg</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">register_to_event</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">sub_type</span><span class="p">,</span> <span class="n">call_back</span><span class="p">)</span>
            <span class="n">with_new_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_camelot_query</span><span class="p">(</span><span class="n">rawmessage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_new_line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">with_new_line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;start_verify_event failed camelot returned null&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;start_verify_event failed </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">def</span> <span class="nf">stop_verify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verifyobj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="n">cseq</span><span class="o">=</span><span class="s1">&#39;ALL&#39;</span><span class="p">):</span>
        <span class="n">event_type</span> <span class="o">=</span> <span class="s1">&#39;verifyevent&#39;</span>
        <span class="n">sub_type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{0}</span><span class="s1">,</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">cseq</span><span class="p">)</span>
        <span class="c1"># msgid = verifyobj.msgid</span>
        <span class="n">outmsg</span> <span class="o">=</span> <span class="s1">&#39;stopverifyevent </span><span class="si">{0}</span><span class="se">\n</span><span class="si">{1}</span><span class="s1">@&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">cseq</span><span class="p">)</span>
        <span class="n">hex_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_get_message_length_hex</span><span class="p">(</span><span class="n">outmsg</span><span class="p">)</span>

        <span class="n">rawmessage</span> <span class="o">=</span> <span class="s1">&#39;m:</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">ep_id</span><span class="p">,</span> <span class="n">hex_len</span><span class="p">,</span> <span class="n">outmsg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">unregister_event</span><span class="p">(</span><span class="n">event_type</span><span class="p">,</span> <span class="n">sub_type</span><span class="p">)</span>
            <span class="n">with_new_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_camelot_query</span><span class="p">(</span><span class="n">rawmessage</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">with_new_line</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">with_new_line</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;stop_verify_event returned NULL&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;stop_verify_event failed reason:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                      <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span>


<span class="k">class</span> <span class="nc">CamlotFeedbackHandler</span><span class="p">(</span><span class="n">CiscoPhoneFeedbackHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">call_info</span><span class="p">,</span> <span class="n">state_machine</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_info</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_machine</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Duplicate registration on feedback handler&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call_info</span> <span class="o">=</span> <span class="n">call_info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_machine</span> <span class="o">=</span> <span class="n">state_machine</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">received_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Received event: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">call_id</span> <span class="o">=</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">call_id</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s1">&#39;alerting&#39;</span> <span class="ow">in</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">call_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_calls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">ignore_complex_spontaneous_calls</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;disconnected&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connected_calls</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">call_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_calls</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">initialized_calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;dialing&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;incoming&#39;</span> <span class="ow">in</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initialized_calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;ringing&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;connected&#39;</span> <span class="ow">in</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">call_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialized_calls</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_initialization_event</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">get_call_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
                    <span class="n">call</span><span class="o">.</span><span class="n">set_expecting_disconnect</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;connected&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;ONHOOK&#39;</span> <span class="ow">in</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="ow">or</span>
                  <span class="s1">&#39;disconnected&#39;</span> <span class="ow">in</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;disconnected&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;REMOTEHOLD&#39;</span> <span class="ow">in</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calls_on_remotehold</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;remote&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;held&#39;</span> <span class="ow">in</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calls_on_localhold</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;local_hold&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;TRANSFERRED&#39;</span> <span class="ow">in</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">ignore_complex_spontaneous_calls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">call_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls_on_localhold</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calls_on_localhold</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;local_hold&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">call_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">calls_on_remotehold</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">calls_on_remotehold</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;remote_hold&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_CCT_case</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_send_initialization_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_id</span><span class="p">):</span>
        <span class="n">matched_call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_call_info</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_call</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Unexpected call-id:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">call_id</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">matched_call</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;outbound&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;dialing&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">matched_call</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inbound&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;ringing&#39;</span><span class="p">,</span> <span class="n">call_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_calls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">call_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_CCT_case</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">callid</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">callid</span><span class="p">:</span>
            <span class="n">call_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_get_call_info</span><span class="p">(</span><span class="n">callid</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">call_info</span> <span class="ow">and</span> <span class="n">call_info</span><span class="p">[</span><span class="s1">&#39;Call State&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;connected&#39;</span> <span class="ow">and</span>
                    <span class="n">callid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connected_calls</span><span class="p">):</span>
                <span class="n">calls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">get_calls</span><span class="p">()</span>
                <span class="n">matched_call</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">call</span><span class="p">[</span><span class="s1">&#39;Ref&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">callid</span><span class="p">:</span>
                        <span class="n">matched_call</span> <span class="o">=</span> <span class="n">call</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">matched_call</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">matched_call_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_get_call_info</span><span class="p">(</span>
                            <span class="n">matched_call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Id&#39;</span><span class="p">))</span>
                        <span class="n">calling_part</span> <span class="o">=</span> <span class="n">matched_call_info</span><span class="p">[</span><span class="s1">&#39;Calling Party Name&#39;</span><span class="p">]</span>
                        <span class="n">called_part</span> <span class="o">=</span> <span class="n">matched_call_info</span><span class="p">[</span><span class="s1">&#39;Called Party Name&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;Conference&#39;</span> <span class="ow">in</span> <span class="n">called_part</span> <span class="ow">or</span>
                                <span class="s1">&#39;Conference&#39;</span> <span class="ow">in</span> <span class="n">calling_part</span><span class="p">):</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Conference call on: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;local_hold&#39;</span><span class="p">,</span> <span class="n">callid</span><span class="p">)</span>
                            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;local_hold&#39;</span><span class="p">,</span> <span class="n">callid</span><span class="p">)</span>
                            <span class="k">return</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;disconnected&#39;</span><span class="p">,</span> <span class="n">callid</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">matched_call_info</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;OUTBOUND&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;dialing&#39;</span><span class="p">,</span> <span class="n">callid</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">matched_call_info</span><span class="p">[</span><span class="s1">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;INBOUND&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;ringing&#39;</span><span class="p">,</span> <span class="n">callid</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">push_new_state</span><span class="p">(</span><span class="s1">&#39;connected&#39;</span><span class="p">,</span> <span class="n">callid</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">call</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">get_call_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
                        <span class="n">call</span><span class="o">.</span><span class="n">set_expecting_disconnect</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;No Call found with the passed call-id&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feedback_receiver</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connected_calls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialized_calls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calls_on_localhold</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calls_on_remotehold</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">feedback_receiver</span> <span class="o">=</span> <span class="n">feedback_receiver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">register_event_callback</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">_generic_callback_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">fb_receiver</span> <span class="o">=</span> <span class="n">feedback_receiver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">start_info_events</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">start_info_events</span><span class="p">(</span><span class="s1">&#39;calls&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">vapi</span><span class="o">.</span><span class="n">start_station_events</span><span class="p">()</span>
        <span class="n">feedback_receiver</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">received_event</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">Camelot Python SDK v12.6.22.12.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../camelot.html" >camelot</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>